(function($,Drupal,once,tabbable){Drupal.webform=Drupal.webform||{};Drupal.webform.codeMirror=Drupal.webform.codeMirror||{};Drupal.webform.codeMirror.options=Drupal.webform.codeMirror.options||{};Drupal.behaviors.webformCodeMirror={attach:function(context){if(!window.CodeMirror){return}
$(once('webform-codemirror','textarea.js-webform-codemirror',context)).each(function(){var $input=$(this);var $details=$input.parents('details:not([open])');$details.attr('open','open');$input.removeAttr('required');var options=$.extend({mode:$input.attr('data-webform-codemirror-mode'),lineNumbers:!0,lineWrapping:($input.attr('wrap')!=='off'),viewportMargin:Infinity,readOnly:!!($input.prop('readonly')||$input.prop('disabled')),extraKeys:{Tab:function(cm){var spaces=Array(cm.getOption('indentUnit')+1).join(' ');cm.replaceSelection(spaces,'end','+element')},Esc:function(cm){var textarea=$(cm.getTextArea());$(textarea).show().addClass('visually-hidden');var $tabbable=$(tabbable.tabbable(document));var tabindex=$tabbable.index(textarea);$(textarea).hide().removeClass('visually-hidden');$tabbable.eq(tabindex+2).trigger('focus')}}},Drupal.webform.codeMirror.options);var editor=CodeMirror.fromTextArea(this,options);$details.removeAttr('open');if($input.css('min-height')){var minHeight=$input.css('min-height');$(editor.getWrapperElement()).css('min-height',minHeight).find('.CodeMirror-scroll').css('min-height',minHeight)}
if($input.css('max-height')){var maxHeight=$input.css('max-height');$(editor.getWrapperElement()).css('max-height',maxHeight).find('.CodeMirror-scroll').css('max-height',maxHeight)}
var changeTimer=null;editor.on('change',function(){if(changeTimer){window.clearTimeout(changeTimer);changeTimer=null}
changeTimer=setTimeout(function(){editor.save()},500)});$input.on('change',function(){editor.getDoc().setValue($input.val())});$input.on('webform:disabled',function(){editor.setOption('readOnly',$input.is(':disabled'))});setTimeout(function(){var $tabPanel=$input.parents('.ui-tabs-panel:hidden');var $details=$input.parents('details:not([open])');if(!$tabPanel.length&&$details.length){return}
$tabPanel.show();$details.attr('open','open');editor.refresh();$tabPanel.hide();$details.removeAttr('open')},500)});if(window.CodeMirror.runMode){$(once('webform-codemirror-runmode','.js-webform-codemirror-runmode',context)).each(function(){CodeMirror.runMode($(this).addClass('cm-s-default').text(),$(this).attr('data-webform-codemirror-mode'),this)})}}}})(jQuery,Drupal,once,tabbable)