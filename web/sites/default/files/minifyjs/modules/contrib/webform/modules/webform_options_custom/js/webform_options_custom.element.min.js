(function($,Drupal,once){Drupal.webformOptionsCustom=Drupal.webformOptionsCustom||{};Drupal.webformOptionsCustom.tippy=Drupal.webformOptionsCustom.tippy||{};Drupal.webformOptionsCustom.tippy.options=Drupal.webformOptionsCustom.tippy.options||{delay:300,allowHTML:!0,followCursor:!0};Drupal.webformOptionsCustom.panAndZoom=Drupal.webformOptionsCustom.panAndZoom||{};Drupal.webformOptionsCustom.panAndZoom.options=Drupal.webformOptionsCustom.panAndZoom.options||{controlIconsEnabled:!0,preventMouseEventsDefault:!1,mouseWheelZoomEnabled:!1};Drupal.behaviors.webformOptionsCustom={attach:function(context){$(once('webform-options-custom','.js-webform-options-custom',context)).each(function(){var $element=$(this);var $select=$element.find('select');var $template=$element.find('.webform-options-custom-template');var $svg=$template.children('svg');var descriptions=$element.attr('data-descriptions')?JSON.parse($element.attr('data-descriptions')):{};var selectOptions={};$select.find('option').each(function(){selectOptions[this.value]=this;selectOptions[this.value].description=descriptions[this.value]});var hasMultiple=$select.is('[multiple]');var hasFill=$element.is('[data-fill]');var hasZoom=$element.is('[data-zoom]');var hasTooltip=$element.is('[data-tooltip]');var hasSelectHidden=$element.is('[data-select-hidden]');var $templateOptions=$template.find('[data-option-value]');var $focusableTemplateOptions=$templateOptions.not('text');if(hasSelectHidden){$select.attr('tabindex','-1')}
$templateOptions.each(function(){var $templateOption=$(this);var value=$templateOption.attr('data-option-value');var option=selectOptions[value];if(!option){$templateOption.removeAttr('data-option-value');return}
initializeSelectOption(option);initializeTemplateOption($templateOption,option);initializeTemplateTooltip($templateOption,option)});initializeZoom();$select.on('change',setSelectValue);$template.on('click',setTemplateValue).on('keydown',function(event){var $templateOption=$(event.target);if(!$templateOption.is('[data-option-value]')){return}
if(event.which===32||event.which===13){setTemplateValue(event);event.preventDefault();return}
if(event.which>=37&&event.which<=40){var $prev;var $next;$focusableTemplateOptions.each(function(index){if(this===event.target){$prev=$focusableTemplateOptions[index-1]?$($focusableTemplateOptions[index-1]):null;$next=$focusableTemplateOptions[index+1]?$($focusableTemplateOptions[index+1]):null}});if(event.which===37||event.which===38){if($prev){$prev.trigger('focus')}}else if(event.which===39||event.which===40){if($next){$next.trigger('focus')}}
event.preventDefault();return}});setSelectValue();function setSelectValue(){var values=(hasMultiple)?$select.val():[$select.val()];clearTemplateOptions();$(values).each(function(index,value){$template.find('[data-option-value="'+value+'"]').attr('aria-checked','true')});setTemplateTabIndex()}
function setTemplateValue(event){var $templateOption=$(event.target);if(!$templateOption.is('[data-option-value]')){$templateOption=$templateOption.parents('[data-option-value]')}
if($templateOption.is('[data-option-value]')){setValue($templateOption.attr('data-option-value'));if($templateOption.is('[href]')){event.preventDefault()}}
setTemplateTabIndex()}
function setTemplateTabIndex(){if(hasMultiple){return}
$template.find('[data-option-value][tabindex="0"]').attr('tabindex','-1');var $checked=$template.find('[data-option-value][aria-checked="true"]');if($checked.length){$checked.not('text').first().attr('tabindex','0')}else{$template.find('[data-option-value]').not('[aria-disabled="true"], text').first().attr('tabindex','0')}}
function setValue(value){if(selectOptions[value].disabled){return}
var $templateOption=$template.find('[data-option-value="'+value+'"]');if($templateOption.attr('aria-checked')==='true'){selectOptions[value].selected=!1;$template.find('[data-option-value="'+value+'"]').attr('aria-checked','false')}else{if(!hasMultiple){clearTemplateOptions()}
selectOptions[value].selected=!0;$template.find('[data-option-value="'+value+'"]').attr('aria-checked','true')}
if($templateOption[0].tagName==='text'){$template.find('[data-option-value="'+value+'"]').not('text').first().trigger('focus')}
$select.trigger('change')}
function initializeSelectOption(option){var text=option.text;var description='';if(text.indexOf(' -- ')!==-1){var parts=text.split(' -- ');text=parts[0];description=parts[1];option.text=text;option.description=description}}
function initializeTemplateOption($templateOption,option){if($templateOption[0].tagName==='text'){return}
$templateOption.attr('role',(hasMultiple)?'radio':'checkbox').attr('aria-checked','false');if(hasFill){$templateOption.css('fill','')}
if(option.disabled){$templateOption.attr('aria-disabled','true')}else{$templateOption.attr('tabindex',(hasMultiple)?'0':'-1')}}
function initializeTemplateTooltip($templateOption,option){if(!hasTooltip||!window.tippy){return}
var content='<div class="webform-options-custom-tooltip--text" data-tooltip-value="'+Drupal.checkPlain(option.value)+'">'+Drupal.checkPlain(option.text)+'</div>';if(option.description){content+='<div class="webform-options-custom-tooltip--description">'+option.description+'</div>'}
var tooltipOptions=$.extend({content:content,},Drupal.webformOptionsCustom.tippy.options);tippy($templateOption[0],tooltipOptions)}
function initializeZoom(){if(!hasZoom||!window.svgPanZoom||!$svg.length){return}
var options=$.extend({},Drupal.webformOptionsCustom.panAndZoom.options);var panZoom=window.svgPanZoom($svg[0],options);$(window).on('resize',function(){panZoom.trigger('resize');panZoom.fit();panZoom.center()})}
function clearTemplateOptions(){$templateOptions.attr('aria-checked','false')}})}}})(jQuery,Drupal,once)