(function($,Drupal,drupalSettings,once){Drupal.webform=Drupal.webform||{};Drupal.webform.locationPlaces=Drupal.webform.locationPlaces||{};Drupal.webform.locationPlaces.options=Drupal.webform.locationPlaces.options||{};var mapping={lat:'lat',lng:'lng',name:'name',postcode:'postcode',locality:'locality',city:'city',administrative:'administrative',country:'country',countryCode:'country_code',county:'county',suburb:'suburb'};Drupal.behaviors.webformLocationPlaces={attach:function(context){if(!window.places){return}
$(once('webform-location-places','.js-webform-type-webform-location-places',context)).each(function(){var $element=$(this);var $input=$element.find('.webform-location-places');$input.on('keydown',function(event){if(event.keyCode===13){event.preventDefault()}});var options=$.extend({type:'address',useDeviceLocation:!0,container:$input.get(0)},Drupal.webform.locationPlaces.options);if(drupalSettings.webform.location.places.app_id&&drupalSettings.webform.location.places.api_key){options.appId=drupalSettings.webform.location.places.app_id;options.apiKey=drupalSettings.webform.location.places.api_key}
var placesAutocomplete=window.places(options);var off=/chrom(e|ium)/.test(window.navigator.userAgent.toLowerCase())?'chrome-off-'+Math.floor(Math.random()*100000000):'off';$input.attr('autocomplete',off);placesAutocomplete.on('change',function(e){$.each(mapping,function(source,destination){var value=(source==='lat'||source==='lng'?e.suggestion.latlng[source]:e.suggestion[source])||'';setValue(destination,value)})});placesAutocomplete.on('clear',function(e){$.each(mapping,function(source,destination){setValue(destination,'')})});if($input.val()===''&&window.navigator.geolocation&&$input.attr('data-webform-location-places-geolocation')){placesAutocomplete.on('reverse',function(e){var suggestion=e.suggestions[0];$input.val(suggestion.value);$.each(mapping,function(source,destination){var value=(source==='lat'||source==='lng'?suggestion.latlng[source]:suggestion[source])||'';setValue(destination,value)})});window.navigator.geolocation.getCurrentPosition(function(response){var coords=response.coords;var lat=coords.latitude.toFixed(6);var lng=coords.longitude.toFixed(6);placesAutocomplete.reverse(lat+','+lng)})}
function setValue(name,value){var inputSelector=':input[data-webform-location-places-attribute="'+name+'"]';$element.find(inputSelector).val(value)}})}}})(jQuery,Drupal,drupalSettings,once)