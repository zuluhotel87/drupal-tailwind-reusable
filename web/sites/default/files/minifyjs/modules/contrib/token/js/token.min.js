(function($,Drupal,drupalSettings){'use strict';Drupal.behaviors.tokenTree={attach:function(context,settings){$(once('token-tree','table.token-tree',context)).treetable({expandable:!0})}};Drupal.behaviors.tokenInsert={attach:function(context,settings){$('textarea, input[type="text"]',context).focus(function(){drupalSettings.tokenFocusedField=this});if(Drupal.CKEditor5Instances){Drupal.CKEditor5Instances.forEach(function(editor){editor.editing.view.document.on('change:isFocused',(event,data,isFocused)=>{if(isFocused){drupalSettings.tokenFocusedCkeditor5=editor}})})}
once('token-click-insert','.token-click-insert .token-key',context).forEach(function(token){var newThis=$('<a href="javascript:void(0);" title="'+Drupal.t('Insert this token into your form')+'">'+$(token).html()+'</a>').click(function(){var content=this.text;if(drupalSettings.tokenFocusedField&&(drupalSettings.tokenFocusedField.tokenDialogFocus||drupalSettings.tokenFocusedField.tokenHasFocus)){insertAtCursor(drupalSettings.tokenFocusedField,content)}else if(typeof(tinyMCE)!='undefined'&&tinyMCE.activeEditor){tinyMCE.activeEditor.execCommand('mceInsertContent',!1,content)}else if(typeof(CKEDITOR)!='undefined'&&CKEDITOR.currentInstance){CKEDITOR.currentInstance.insertHtml(content)}else if(typeof(CodeMirror)!='undefined'&&drupalSettings.tokenFocusedField&&$(drupalSettings.tokenFocusedField).parents('.CodeMirror').length){var editor=$(drupalSettings.tokenFocusedField).parents('.CodeMirror')[0].CodeMirror;editor.replaceSelection(content);editor.focus()}else if(Drupal.wysiwyg&&Drupal.wysiwyg.activeId){Drupal.wysiwyg.instances[Drupal.wysiwyg.activeId].insert(content)}else if(typeof(CKEDITOR)!='undefined'&&typeof(Drupal.ckeditorActiveId)!='undefined'){CKEDITOR.instances[Drupal.ckeditorActiveId].insertHtml(content)}else if(drupalSettings.tokenFocusedField){insertAtCursor(drupalSettings.tokenFocusedField,content)}else if(drupalSettings.tokenFocusedCkeditor5){const editor=drupalSettings.tokenFocusedCkeditor5;editor.model.change((writer)=>{writer.insertText(content,editor.model.document.selection.getFirstPosition(),)})}else{alert(Drupal.t('First click a text field to insert your tokens into.'))}
return!1});$(token).html(newThis)});function insertAtCursor(editor,content){var scroll=editor.scrollTop;if(document.selection){editor.focus();var sel=document.selection.createRange();sel.text=content}else if(editor.selectionStart||editor.selectionStart=='0'){var startPos=editor.selectionStart;var endPos=editor.selectionEnd;editor.value=editor.value.substring(0,startPos)+content+editor.value.substring(endPos,editor.value.length)}else{editor.value+=content}
editor.scrollTop=scroll}}}})(jQuery,Drupal,drupalSettings)