(($,Drupal,{tabbable})=>{Drupal.ClaroBulkActions=class{constructor(bulkActions){this.bulkActions=bulkActions;this.form=this.bulkActions.closest('form');this.form.querySelectorAll('tr').forEach((element)=>{element.classList.add('views-form__bulk-operations-row')});this.checkboxes=this.form.querySelectorAll('[class$="bulk-form"]:not(.select-all) input[type="checkbox"]',);this.selectAll=this.form.querySelectorAll('.select-all > [type="checkbox"]',);this.$tabbable=$(tabbable(this.form));this.bulkActionsSticky=!1;this.scrollingTimeout='';this.ignoreScrollEvent=!1;$(this.checkboxes).on('change',(event)=>this.rowCheckboxHandler(event),);$(this.selectAll).on('change',(event)=>this.selectAllHandler(event));this.$tabbable.on('focus',(event)=>this.focusHandler(event));this.$tabbable.on('blur',(event)=>this.blurHandler(event));this.spacerCss=document.createElement('style');document.body.appendChild(this.spacerCss);const scrollResizeHandler=Drupal.debounce(()=>{this.scrollResizeHandler()},10);$(window).on('scroll',()=>scrollResizeHandler());$(window).on('resize',()=>scrollResizeHandler());$(window).on('load',()=>this.rowCheckboxHandler({}))}
blurHandler(event){if(!event.hasOwnProperty('isTrigger')){const row=event.target.closest('tr');const nextSibling=row?row.nextElementSibling:null;if(nextSibling&&nextSibling.getAttribute('data-drupal-table-row-spacer')){nextSibling.parentNode.removeChild(nextSibling)}}}
focusHandler(event){if(event.currentTarget.closest('[data-drupal-views-bulk-actions]')){return}
const stickyRect=this.bulkActions.getBoundingClientRect();const stickyStart=stickyRect.y;const elementRect=event.target.getBoundingClientRect();const elementStart=elementRect.y;const elementEnd=elementStart+elementRect.height;if(elementEnd>stickyStart){window.scrollBy(0,elementEnd-stickyStart)}
this.underStickyHandler()}
scrollResizeHandler(){this.spacerCss.innerHTML='[data-drupal-table-row-spacer] { display: none; }';if(!this.ignoreScrollEvent){clearTimeout(this.scrollingTimeout);this.scrollingTimeout=setTimeout(()=>{this.spacerCss.innerHTML='';this.underStickyHandler()},500)}}
underStickyHandler(){document.querySelectorAll('[data-drupal-table-row-spacer]').forEach((element)=>{element.parentNode.removeChild(element)});if(this.bulkActionsSticky){let pastStickyHeader=!1;const stickyRect=this.bulkActions.getBoundingClientRect();const stickyStart=stickyRect.y;const stickyEnd=stickyStart+stickyRect.height;this.form.querySelectorAll('tbody tr').forEach((row)=>{if(!pastStickyHeader){const rowRect=row.getBoundingClientRect();const rowStart=rowRect.y;const rowEnd=rowStart+rowRect.height;if(rowStart>stickyEnd){pastStickyHeader=!0}else if(rowEnd>stickyStart){const cellTopPadding=Array.from(row.querySelectorAll('td.views-field'),).map((element)=>document.defaultView.getComputedStyle(element,'').getPropertyValue('padding-top').replace('px',''),);const minimumTopPadding=Math.min.apply(null,cellTopPadding);if(rowStart+minimumTopPadding>=stickyStart){const oldScrollTop=window.scrollY||document.documentElement.scrollTop;const scrollLeft=window.scrollX||document.documentElement.scrollLeft;const rowContainsActiveElement=row.contains(document.activeElement,);if(rowContainsActiveElement){this.ignoreScrollEvent=!0}
const spacer=document.createElement('div');spacer.style.height=`${stickyRect.height}px`;spacer.setAttribute('data-drupal-table-row-spacer',!0);row.parentNode.insertBefore(spacer,row);const newScrollTop=window.scrollY||document.documentElement.scrollTop;const windowBottom=window.innerHeight||document.documentElement.clientHeight;if(rowContainsActiveElement&&oldScrollTop!==newScrollTop&&rowStart<windowBottom){window.scrollTo(scrollLeft,oldScrollTop)}
this.ignoreScrollEvent=!1}}}})}}
selectAllHandler(event){if(!event.hasOwnProperty('isTrigger')){const itemsCheckedCount=event.target.checked?this.checkboxes.length:0;this.updateStatus(itemsCheckedCount);this.underStickyHandler()}}
rowCheckboxHandler(event){if(!event.hasOwnProperty('isTrigger')){this.updateStatus(Array.prototype.slice.call(this.checkboxes).filter((checkbox)=>checkbox.checked).length,)}}
updateStatus(count){let statusMessage='';let operationsAvailableMessage='';if(count>0){if(!this.bulkActionsSticky){operationsAvailableMessage=Drupal.t('Bulk actions are now available. These actions will be applied to all selected items. This can be accessed via the "Skip to bulk actions" link that appears after every enabled checkbox. ',);this.bulkActionsSticky=!0;setTimeout(()=>this.underStickyHandler(),350);const stickyRect=this.bulkActions.getBoundingClientRect();const bypassAnimation=stickyRect.top+stickyRect.height<window.scrollY+window.innerHeight;const classAction=bypassAnimation?'add':'remove';this.bulkActions.classList[classAction]('views-form__header--bypass-animation',)}
statusMessage=Drupal.formatPlural(count,'1 item selected','@count items selected',)}else{this.bulkActionsSticky=!1;statusMessage=Drupal.t('No items selected');setTimeout(()=>this.underStickyHandler(),350)}
this.bulkActions.setAttribute('data-drupal-sticky-vbo',this.bulkActionsSticky,);this.bulkActions.querySelector('[data-drupal-views-bulk-actions-status]',).textContent=statusMessage;Drupal.announce(operationsAvailableMessage+statusMessage);this.underStickyHandler()}};Drupal.behaviors.claroTableSelect={attach(context){const bulkActions=once('ClaroBulkActions','[data-drupal-views-bulk-actions]',context,);bulkActions.map((bulkActionForm)=>new Drupal.ClaroBulkActions(bulkActionForm),)},}})(jQuery,Drupal,window.tabbable,once)