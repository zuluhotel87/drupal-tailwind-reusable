(function($,{tabbable,isTabbable}){$.widget('ui.dialog',$.ui.dialog,{options:{buttonClass:'button',buttonPrimaryClass:'button--primary',},_createButtons(){const opts=this.options;let primaryIndex;let index;const il=opts.buttons.length;for(index=0;index<il;index++){if(opts.buttons[index].primary&&opts.buttons[index].primary===!0){primaryIndex=index;delete opts.buttons[index].primary;break}}
this._super();const $buttons=this.uiButtonSet.children().addClass(opts.buttonClass);if(typeof primaryIndex!=='undefined'){$buttons.eq(index).addClass(opts.buttonPrimaryClass)}},_createWrapper(){this.uiDialog=$('<div>').hide().attr({tabIndex:-1,role:'dialog','aria-modal':this.options.modal?'true':null,}).appendTo(this._appendTo());this._addClass(this.uiDialog,'ui-dialog','ui-widget ui-widget-content ui-front',);this._on(this.uiDialog,{keydown(event){if(this.options.closeOnEscape&&!event.isDefaultPrevented()&&event.keyCode&&event.keyCode===$.ui.keyCode.ESCAPE){event.preventDefault();this.close(event);return}
if(event.keyCode!==$.ui.keyCode.TAB||event.isDefaultPrevented()){return}
const tabbableElements=tabbable(this.uiDialog[0]);if(tabbableElements.length){const first=tabbableElements[0];const last=tabbableElements[tabbableElements.length-1];if((event.target===last||event.target===this.uiDialog[0])&&!event.shiftKey){this._delay(function(){$(first).trigger('focus')});event.preventDefault()}else if((event.target===first||event.target===this.uiDialog[0])&&event.shiftKey){this._delay(function(){$(last).trigger('focus')});event.preventDefault()}}},mousedown(event){if(this._moveToTop(event)){this._focusTabbable()}},});if(!this.element.find('[aria-describedby]').length){this.uiDialog.attr({'aria-describedby':this.element.uniqueId().attr('id'),})}},_focusTabbable(){let hasFocus=this._focusedElement?this._focusedElement.get(0):null;if(!hasFocus){hasFocus=this.element.find('[autofocus]').get(0)}
if(!hasFocus){const $elements=[this.element,this.uiDialogButtonPane];for(let i=0;i<$elements.length;i++){const element=$elements[i].get(0);if(element){const elementTabbable=tabbable(element);hasFocus=elementTabbable.length?elementTabbable[0]:null}
if(hasFocus){break}}}
if(!hasFocus){const closeBtn=this.uiDialogTitlebarClose.get(0);hasFocus=closeBtn&&isTabbable(closeBtn)?closeBtn:null}
if(!hasFocus){hasFocus=this.uiDialog.get(0)}
$(hasFocus).eq(0).trigger('focus')},})})(jQuery,window.tabbable)