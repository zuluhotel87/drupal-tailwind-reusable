const log=require('./log');const fs=require('node:fs');const postcss=require('postcss');const postcssImport=require('postcss-import');const postcssHeader=require('postcss-header');const postcssUrl=require('postcss-url');const postcssPresetEnv=require('postcss-preset-env');const postcssPixelsToRem=require('postcss-pxtorem');const prettier=require('prettier');const removeUnwantedComments=require('./remove-unwanted-comments');module.exports=(filePath,callback)=>{fs.readFile(filePath,(err,css)=>{postcss([postcssImport({plugins:[removeUnwantedComments,],}),postcssPresetEnv({stage:1,preserve:!1,autoprefixer:{cascade:!1,grid:'no-autoplace',},features:{'blank-pseudo-class':!1,'focus-visible-pseudo-class':!1,'focus-within-pseudo-class':!1,'has-pseudo-class':!1,'image-set-function':!1,'prefers-color-scheme-query':!1,}}),postcssPixelsToRem({propList:['*','!background-position','!border','!border-width','!box-shadow','!border-top*','!border-right*','!border-bottom*','!border-left*','!border-start*','!border-end*','!outline*',],mediaQuery:!0,minPixelValue:3,exclude:(filePath)=>filePath.match(/core\/modules.*\.icons\..*\.pcss\.css$/)}),postcssHeader({header:`/*\n * DO NOT EDIT THIS FILE.\n * See the following change record for more information,\n * https://www.drupal.org/node/3084859\n * @preserve\n */\n`,}),postcssUrl({filter:'**/*.svg',url:'inline',optimizeSvgEncode:!0,})]).process(css,{from:filePath}).then(async result=>{const config=await prettier.resolveConfig(filePath);return await prettier.format(result.css,config)}).then(callback).catch(error=>{log(error);process.exitCode=1})})}