export default class DrupalHtmlBuilder{constructor(){this.chunks=[];this.selfClosingTags=['area','base','br','col','embed','hr','img','input','link','meta','param','source','track','wbr',];this.rawTags=['script','style']}
build(){return this.chunks.join('')}
appendNode(node){if(node.nodeType===Node.TEXT_NODE){this._appendText(node)}else if(node.nodeType===Node.ELEMENT_NODE){this._appendElement(node)}else if(node.nodeType===Node.DOCUMENT_FRAGMENT_NODE){this._appendChildren(node)}else if(node.nodeType===Node.COMMENT_NODE){this._appendComment(node)}}
_appendElement(node){const nodeName=node.nodeName.toLowerCase();this._append('<');this._append(nodeName);this._appendAttributes(node);this._append('>');if(!this.selfClosingTags.includes(nodeName)){this._appendChildren(node);this._append('</');this._append(nodeName);this._append('>')}}
_appendChildren(node){Object.keys(node.childNodes).forEach((child)=>{this.appendNode(node.childNodes[child])})}
_appendAttributes(node){Object.keys(node.attributes).forEach((attr)=>{this._append(' ');this._append(node.attributes[attr].name);this._append('="');this._append(this.constructor._escapeAttribute(node.attributes[attr].value),);this._append('"')})}
_appendText(node){const doc=document.implementation.createHTMLDocument('');const container=doc.createElement('p');container.textContent=node.textContent;if(node.parentElement&&this.rawTags.includes(node.parentElement.tagName.toLowerCase())){this._append(container.textContent)}else{this._append(container.innerHTML)}}
_appendComment(node){this._append('<!--');this._append(node.textContent);this._append('-->')}
_append(str){this.chunks.push(str)}
static _escapeAttribute(text){return text.replace(/&/g,'&amp;').replace(/'/g,'&apos;').replace(/"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\r\n/g,'&#13;').replace(/[\r\n]/g,'&#13;')}}